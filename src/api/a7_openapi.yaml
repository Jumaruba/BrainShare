openapi: 3.0.0
servers:
  # Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/lbaw2152/Brainshare/1.0.0
  - description: Website production server.
    url: lbaw2152-piu.lbaw-prod.fe.up.pt/
info:
  version: "1.0.0"
  title: Brainshare API
  description: Web resources specification for Brainshare

# Missing servers: Professor? 

# Add the url later. 
externalDocs: 
  description: It's possible to find more information here.  
  url: https://app.swaggerhub.com/apis/lbaw2152/Brainshare/1.0.0#/


tags:
  - name: 'M01: Authentication and User Profile'
  - name: 'M02: Questions' 
  - name: 'M03: Management'
  - name: 'M04: Static Pages' 
  
paths:

########################################
# M01: Authentication and User Profile #
########################################
  # R101 and R102
  /auth/login:
    get:
      operationId: R101
      summary: "R101: Login form"
      description: "Provides the login form. Access: PUB"
      tags: 
        - 'M01: Authentication and User Profile'
      responses:
        "200":
          description: "OK. Show the [UI06](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui06-login)" 

    post:
      operationId: R102
      summary: "R102: Login Action"
      description: "Processes the login action. Access: PUB"  
      tags:  
        - 'M01: Authentication and User Profile'

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string

              required:
                - email
                - password

            example: 
              email: "up201800123@edu.fe.up.pt"
              password: "lbaw2152"

      responses:
        "302":
          description: "Redirected. Login credentials processed."
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Success authetication. Redirected to the search questions page [UI02](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui02-search)"
                  value: "/search"
                302Error:
                  description: "Failed authetication. Redirected to the login page form [UI06](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui06-login)"
                  value: "/auth/login"
   
  # R103 
  /auth/logout:
    post:
      operationId: R103
      summary: "R103: Logout Action"
      description: "Logout the current authenticated user. Access: USR, MOD, ADM"
      tags:  
        - 'M01: Authentication and User Profile'
      
      responses:
        "302":
          description: "Redirect to the home page after logout. "
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Successful logout. Redirected to the home page [UI01](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui01-home)"
                  value: "/"

  # R104 and R105
  /auth/register:
    get:
      operationId: R104
      summary: "R104: Register form"
      description: "Provide the form for the user registration. Access: PUB"
      tags:  
        - 'M01: Authentication and User Profile'
      responses:
        "200":
          description: "OK. Show the [UI07](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui07-register)"

    post:
      operationId: R105
      summary: "R105: Register Action"
      description: "Process the register form" 
      tags:  
        - 'M01: Authentication and User Profile'

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                username:
                  type: string
                email:
                  type: string
                password:
                  type: string
                image:
                  type: string
                  format: binary

              required:
                - username
                - email
                - password

      responses:
        "302":
          description: "Redirect after user register form has been processed."

          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Successful authentication. Redirect to the search questions page [UI02](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui02-search)"
                  value: "/search"
                302Error:
                  description: "Failed authentication. Redirect to the register page [UI07](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui07-register)."
                  value: "/auth/register"
  
  # R106
  /user/{id}/questions:
    get:
      operationId: R106
      summary: "R106: View the user profile and his questions."
      description: "Show the user profile and the questions created by him. Access: USR"
      tags:  
        - 'M01: Authentication and User Profile'

      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true

      responses:
        "200":
          description: "OK. Show [UI05](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui05-profile) with the question tab selected."

  # R107
  /user/{id}/answers:
    get:
      operationId: R107
      summary: "R107: View the user profile and his answers."
      description: "Show the user profile and the answers created by him. Access: USR"
      tags:  
        - 'M01: Authentication and User Profile'

      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true

      responses:
        "200":
          description: "OK. Show [UI05](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui05-profile) with the answer tab selected."

  /user/edit-profile: 
    get:
      operationId: R108
      summary: "R108: View the update profile form for the user."
      description: "Show the form to edit the profile of a user. Access: OWN"
      tags:  
        - 'M01: Authentication and User Profile'

      responses:
        "200":
          description: "OK. Show [UI11](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui11-edit-profile)."


    put:
      operationId: R109
      summary: "R109: Update a user profile."
      description: "Update the user profile information. Access: OWN."
      tags:  
      - 'M01: Authentication and User Profile'

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                birthday:
                  type: string
                about:
                  type: string
                course:
                  type: array
                  items:
                    type: string
                tags:
                  type: array
                  items:
                    type: string

            example: 
              name: "Joaquina"
              email: "up201800123@edu.fe.up.pt"
              birthday: "19/01/2000"
              about: "Hello, it's Joaquina and I like to program!"
              course: ["MIEIC", "MIEEC"]
              tags: ["c++", "php"]
      
      responses:
        "302":
          description: "Redirect after user edit profile form has been processed."

          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Success. Redirects to the user profile."
                  value: "/user/{id}/questions"
                302Error:
                  description: "Failed authentication. The user stays on the page."

  # Notification  
  /user/notification:
    get:
      operationId: "R110"
      summary: "R110: Loads and view the user's notification."
      description: "Shows the Notification. Access: OWN"
      tags:  
        - 'M01: Authentication and User Profile'

      responses:
        "200":
          description: "Ok, show [UI14](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui14-notifications)"

  /user/notification/{id}: 
    delete:
      operationId: R111
      summary: "R111: Delete a Notification"
      description: "Delete a Notification. Access: OWN"
      tags:  
      - 'M01: Authentication and User Profile'

      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true

      responses:
        "202":
          description: "Accepted. Render the notification list without the deleted notification."

    put:
      operationId: R112
      summary: "R112: Mark as read"
      description: "Updates a Notification, marking it as read. Access: OWN"
      tags:  
        - 'M01: Authentication and User Profile'

      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true 

      responses:
        "202":
          description: "Accepted. Render the notification list with the refered notification marked as read."   
  
  # Reports 
  /user/{id}/report: 
    post: 
      operationId: R113
      summary: "R113: Report a user."
      description: "Proccess the report of a user. Access: USR"  
      tags:  
        - 'M01: Authentication and User Profile'

      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true

      responses:
        "200": 
          description: "Success. User reported."

  
 
#################
# M02 Questions #
#################

  # ASK: what to do with the button of search, like tags and etc? 
  # R201
  /search/{text}: 
    get: 
      operationId: "R201"
      summary: "R201: Shows the search page."
      description: "Shows the search page with the content searched for if not empty. Access: PUB"
      tags:  
      - 'M02: Questions'

      parameters:
        - in: path
          name: "text"
          description: "Content to be searched for."
          schema:
            type: string
          required: true

      responses: 
        "200": 
          description: "Ok. Show the search page [UI02](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui02-search)"

  #R202
  /search/most-voted: 
    get: 
      operationId: "R202"
      summary: "R202: Shows the search page with questions organized by the most voted."
      description: "Shows the search page. Access: PUB"
      tags:  
      - 'M02: Questions' 

      responses: 
        "200": 
          description: "Ok. Show the search page [UI02](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui02-search)"

  #R203 and 204
  /add-question:
    get: 
      operationId: "R203"
      summary: "R203: Shows the create question page."
      description: "Create new question. Access: USR"
      tags:  
      - 'M02: Questions'
    

      responses: 
        "200": 
          description: "Ok. Show the add question page [UI04](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui04-add-question)"

    post:
      operationId: "R204"
      summary: "R204: Question being processed."
      description: "Create new question. Access: USR"
      tags:  
      - 'M02: Questions'
      
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                title:
                  type: string
                content:
                  type: string
                courses:
                  type: array
                  items:
                    type: string
                tags:
                  type: array
                  items:
                    type: string
                

              required:
                - title
                - content
                - date
      
            example:
              title: "Is it hard to program in C?"
              content: "I've been struggling to learn it. I don't know if I'm dumb or if it's really hard."
              courses: ["MIEIC", "MIEEC"]
              tags: ["c++", "php"]

      responses:
        "302":
            description: "Redirect after the question creation is processed."

            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: "Successful, redirects to the question page."
                    value: "/search"
                  302Error:
                    description: "Failed creation. Redirects to the same page."
                    value: "/question/create"
  
  #205, R206 and 207  
  /question/{id}:
    get:
      operationId: R205
      summary: "R205: View and load the page of a question."
      description: "Shows the question page, which contains the question, answers, respective comments and also text fields to add more answers and comments. Access: PUB"
      tags:  
        - 'M02: Questions'
      
      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true
          
      responses: 
        "200": 
          description: "Success. Show the question page [UI03](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui03-question)"
          
    put:
      operationId: R206
      summary: "R206: Update a question"
      description: "Update question. Access: OWN, ADM, MOD"
      tags:  
        - 'M02: Questions'
      
      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                title:
                  type: string
                text:
                  type: string
                courses:
                  type: array 
                  items: 
                    type: string
                tags:
                  type: array 
                  items: 
                    type: string 
             
  
            example:
              title: "How to solve this problem?"
              text: "I have no idea how to solve this problem"
              courses: ["MIEIC", "MIEEC"]
              tags: ["c++","php"]
                
      responses:
        "302":
          description: "Redirect after the update is processed."

          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Successful, redirects to the question page."
                  value: "/question/{id}"
                  
          
    delete:
      operationId: R207
      summary: "R207: Delete a question"
      description: "Deletes a question. Access: OWN, ADM, MOD"
      tags:  
        - 'M02: Questions'

      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true

      responses:
        "302":
            description: "Redirect after the update is processed."

            headers:
              Location:
                schema:
                  type: string
                examples:
                  302Success:
                    description: "Successful, redirects back to the search page."
                    # TODO: change name after creating the search path
                    value: "/search"
                  302Error:
                    description: "Failed delete. Stay on the same page."
 
  #208
  /question/{id}/add-answer:
    post:
      operationId: R208
      summary: "R208: Answer being processed."
      description: "Create new answer. Access: USR"
      tags:  
      - 'M02: Questions' 


      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true


      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string 

              required:
                - content
            

            example:
              - content: "I think that C is easy. You're the one that is dumb."

      responses: 
        "202": 
          description: "Ok. Use the new information to render the page."
  
  #R209 and R210 
  /question/{id-question}/answer/{id-answer}: 
    put:
      operationId: R209
      summary: "R209: Answer being processed."
      description: "Update an answer. Access: OWN, MOD, ADM"
      tags:  
      - 'M02: Questions' 


      parameters:
        - in: path
          name: "id-question"
          schema:
            type: integer
          required: true
        - in: path 
          name: "id-answer"
          schema: 
            type: integer 
          required: true 
          
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string 

              required:
                - content

            example:
              - content: "I think that C is easy. You're the one that is dumb."

      responses: 
        "202": 
          description: "Ok. Use the new information to render the page."
  
    delete:
      operationId: R210
      summary: "R210: Delete a comment"
      description: "Deletes a comment. Access: OWN, ADM, MOD"
      tags:  
      - 'M02: Questions' 
      

      parameters:
        - in: path
          name: "id-question"
          schema:
            type: integer
          required: true
        - in: path 
          name: "id-answer"
          schema:
            type: integer 
          required: true 

      responses:
        "202":
          description: "Ok. Use the information to render the page."

  #R211
  /question/{id}/add-comment:
    post:
      operationId: "R211"
      summary: "R211: Comment being processed."
      description: "Create new comment. Access: USR"
      tags:  
      - 'M02: Questions' 
    
      parameters:
        - in: path
          name: "id"
          schema:
            type: integer
          required: true 
          
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                commentId: 
                  type: integer 
                content:
                  type: string 

              required:
                - content

            example:
              commentId: 1 
              content: "I think that C is easy. You're the one that is dumb."
        
      responses: 
        "202": 
          description: "Ok. Use the information to render the question page. " 
  
  #R212 and R213
  /question/{id-question}/comment/{id-comment}:
    put:
      operationId: "R212"
      summary: "R212: Comment being processed."
      description: "Update a comment. Access: OWN, MOD, ADM"
      tags:  
      - 'M02: Questions' 


      parameters:
        - in: path
          name: "id-question"
          schema:
            type: integer
          required: true 
        - in: path 
          name: "id-comment"
          schema: 
            type: integer  
          required: true 
        

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string 

              required:
                - content

            example:
              content: "I think that C is easy. You're the one that is dumb."

      responses: 
        "202": 
          description: "Ok. Use the new information to render the page."
    
    delete:
      operationId: R213
      summary: "R213: Delete a comment"
      description: "Deletes a comment. Access: OWN, ADM, MOD"
      tags:  
      - 'M02: Questions' 
      
      parameters:
        - in: path
          name: "id-question"
          schema:
            type: integer
          required: true 
        - in: path 
          name: "id-comment"
          schema: 
            type: integer  
          required: true 

      responses:
        "202":
          description: "Ok. Use the information to render the page."

  #R214
  /question/{id}/report: 
    post: 
      operationId: R214
      summary: "R214: Report a question."
      description: "Process the question report. Access: USR"  
      tags:  
        - 'M02: Questions'

      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true

      responses:
        "200": 
          description: "Success. Feedback on success message."


  # R215
  /comment/{id}/report: 
    post: 
      operationId: R215
      summary: "R215: Report a comment."
      description: "Proccesses comment report. Access: USR"  
      tags:  
        - 'M02: Questions'

      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true

      responses:
        "200": 
          description: "Success. Feedback on success message."


  # R216
  /answer/{id}/report: 
    post: 
      operationId: R216
      summary: "R216: report an answer"
      description: "Proccesses the report of an answer. Access: USR"  
      tags:  
        - 'M02: Questions'
  
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
  
  
      responses:
        "200": 
          description: "Success. Feedback on success message."



###################
# M03: Management #
################### 

  # R301
  /admin/course/{text}: 
    get: 
      operationId: "R301"
      summary: "R301: Show the courses"
      description: "Shows the categories page with the course tab selected and result of the text search if defined. Case not defined the results shown will be the deafult. Access: MOD, ADM"
      tags:  
      - 'M03: Management'

      parameters:
        - in: path
          name: "text"
          description: "Content to be searched for"
          schema:
            type: string
          required: true

      responses: 
        "200": 
          description: "Ok. Show the manage categories page with course tab selected [UI09](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui09-manage-categories)"
  
  # R302
  /admin/course/{id}:
    delete:
      operationId: "R302"
      summary: "R302: Delete a course"
      description: "Deletes a course. Access: ADM, MOD"
      tags:
      - 'M03: Management'

      parameters: 
        - in: path   
          name: id 
          schema: 
            type: string  
          required: true

      responses:
        "202":
          description: "Delete successfully. Use the information to render the page again with the course tab selected."

  # 303 
  /admin/add-course:   
    post:
      operationId: R303
      summary: "R303 : Course being processed."
      description: "Create a new course. Access: ADM, MOD"
      tags:
      - 'M03: Management'

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
              required:
                - name

            example:
              - name: "MIEC"
          
      # The page must render before query has succeded. 
      responses:
        "202":
          description: "Ok. Request accepted to be processed. Use the information to render the page."
        
  # R304 
  /admin/tag/{text}: 
    get: 
      operationId: "R304"
      summary: "R304: Show the tags"
      description: "Shows the categories page with the tag tab selected and result of the text search if defined. Access: PUB"
      tags:  
      - 'M03: Management'

      parameters:
        - in: path
          name: "text"
          description: "Content to be searched for."
          schema:
            type: string
          required: true

      responses: 
        "200": 
          description: "Ok. Show the manage categories page with course tab selected [UI09](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui09-manage-categories)"
  
  # R305 
  /admin/tag/{id}: 
    delete:
      operationId: "R305"
      summary: "R305: Delete a tag"
      description: "Deletes a tag. Access: ADM, MOD"
      tags:
      - 'M03: Management'

      parameters:
        - in: path
          name: "id"
          description: "Id of the tag to be deleted"
          schema:
            type: integer
          required: true
        

      responses:
        "202":
          description: "Delete successfully. Use the information to render the page again with the course tab selected."

  # R306
  /admin/add-tag: 
    post:
      operationId: R306
      summary: "R306 : Tag being processed."
      description: "Create new tag. Access: ADM, MOD"
      tags:
      - 'M03: Management'
      
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
              required:
                - name

            example:
              name: "MIEC"

      responses:
        "202":
          description: "Ok. Request accepted to be processed. Use the information to render the page."
        


# Report

  # R307
  /admin/reports/{text}:
    get: 
      operationId: "R307"
      summary: "R307: Show the courses"
      description: "Shows the categories page with the course tab selected and result of the text search if defined. Access: ADM, MOD"
      tags:  
      - 'M02: Questions'

      parameters:
        - in: path
          name: "text"
          description: "Content to be searched for."
          schema:
            type: string
          required: true

      responses: 
        "200": 
          description: "Ok. Show the manage categories page with course tab selected [UI09](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui09-manage-categories)"
  
  # R308
  /admin/reports/user/{id}:
    put: 
      operationId: "R308"
      summary: "R308 : Mark reports os a user as read."  
      description: "Mark all the reports related to this user as read. Access: ADM, MOD"
      tags:
        - 'M03: Management'   

      parameters: 
        - in: path 
          name: "id" 
          schema: 
            type: integer 
          required: true 

      responses: 
        "202": 
          description: "OK. Process action and use the information to render the page again."

  # R309
  /admin/reports/question/{id}: 
    put: 
      operationId: "R309"
      summary: "R309 : Mark question reports as read."  
      description: "Mark all the reports related to this question as read. Access: ADM, MOD"
      tags:
        - 'M03: Management'   

      parameters: 
        - in: path 
          name: "id" 
          schema: 
            type: integer 
          required: true 

      responses: 
        "202": 
          description: "OK. Process action and use the information to render the page again."

  # R310
  /admin/reports/answer/{id}:
    put: 
      operationId: "R310"
      summary: "R310 : Mark reports of an answer as read."  
      description: "Mark all the reports related to this user as read. Access: ADM, MOD"
      tags:
        - 'M03: Management'   

      parameters: 
        - in: path 
          name: "id" 
          schema: 
            type: integer 
          required: true 

      responses: 
        "202": 
          description: "OK. Process action and use the information to render the page again."

  #311
  /admin/reports/comment/{id}:   
    put: 
      operationId: "R311"
      summary: "R311 : Mark as read."  
      description: "Mark all the reports related to this user as read. Access: ADM, MOD"
      tags:
        - 'M03: Management'   

      parameters: 
        - in: path 
          name: "id" 
          schema: 
            type: integer 
          required: true 

      responses: 
        "202": 
          description: "OK. Process action and use the information to render the page again."

##############
# BAN AND PROMOTE
##############

  # R312
  /user/{id}/delete: 
    delete:
      operationId: R312
      summary: "R312: Deletes a user profile."
      description: "Update the user profile information. Access: OWN, MOD, ADM."
      tags:  
        - 'M01: Authentication and User Profile'

      responses:
        "200":
          description: "OK. Update succeded."

 
  # R313 
  /manage/user/{id}/status: 
    put: 
      operationId: R313 
      summary: "R313: Ban/Unban a user."
      description: "Update the state of user to ban or unban. Access: MOD, ADM."  
      tags: 
        - 'M03: Management'

      parameters: 
        - in: path 
          name: "id" 
          schema: 
            type: integer 
          required: true 
      
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: boolean 
                role: 
                  type: string 

            example:
              type: false 
              role: "ADM" 

      responses: 
        "202": 
          description: "OK. Render the page according to the new status. "

 

#####################
# M04: Static Pages #
#####################

  /:
    get:
      operationId: R401
      summary: "R401: View home page "
      description: "Shows the home page. Access: PUB"
      tags:
      - 'M04: Static Pages'

      responses:
        "202":
          description: "Ok. Show the home page [UI01](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui01-home)." 

  /about:
    get:
      operationId: R402
      summary: "R402: View the about page "
      description: "Shows the about page. Access: PUB"
      tags:
      - 'M04: Static Pages'

      responses:
        "202":
          description: "Ok. Show the about page [UI013](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2152/-/wikis/ER#ui13-about)."   
      
  /error:   
    get:
      operationId: R403 
      summary: "R403: View the error page"
      description: "Shows the error page. Access: PUB"
      tags: 
        - "M04: Static Pages"
      
      responses: 
        "202":
          description: "Ok, Show the error page."
      